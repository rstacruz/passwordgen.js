#!/usr/bin/env node
// vim:ft=javascript

var cli = require('commander');
var crypto = require('crypto');
var passwordgen = require('../lib')(random);
var Words = passwordgen.Words;
var Chars = passwordgen.Chars;

function random() {
  var prec = 3;
  var buf = crypto.randomBytes(prec);
  var max = 1 << (8*prec);
  var acc = 0;

  for (var i=0; i<prec; ++i) { acc = (acc << 8) + buf[i]; }
  return acc/max;
}

cli
  .option('-w, --words <n>', 'generate <n> words')
  .option('-c, --chars <n>', 'generate <n> characters')
  .option('-s, --symbols', 'include symbols')
  .on('--help', function() {
    console.log('');
    console.log('  Examples:');
    console.log('');
    console.log('    $ gen         #=> EH8peEWVyYskuPh');
    console.log('    $ gen -c 5    #=> WsPnA');
    console.log('    $ gen -w 4    #=> correct horse battery staple');
  })
  .parse(process.argv);

var str;

if (cli.words) {
  str = Words.words(cli.words || 4, cli).join(" ");
}
else {
  str = Chars.generate(cli.chars || 15, cli);
}

console.log(str);
